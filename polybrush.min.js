!function(n){n.polybrush=function(){var t=n.dispatch("brushstart","brush","brushend"),e=null,r=null,u=[],l=!0,o=!0,s=!1,i=null,c=n.line().x(function(n){return n[0]}).y(function(n){return n[1]}),h=function(t){t.each(function(){var l,o;l=(t=n.select(this).style("pointer-events","all").on("click.brush",g)).selectAll(".background").data([0]).enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([u]).enter().append("path").attr("class","extent").style("cursor","move"),e&&(o=f(e.range()),l.attr("x",o[0]).attr("width",o[1]-o[0])),r&&(o=f(r.range()),l.attr("y",o[0]).attr("height",o[1]-o[0]))})},a=function(){return n.selectAll("g path").attr("d",function(n){return c(n)+"Z"})},f=function(n){var t,e;return t=n[0],e=n[n.length-1],t<e?[t,e]:[e,t]},b=function(n){var t,u,l,o;return t=f(e.range()),u=f(r.range()),l=Math.max(t[0],Math.min(t[1],n[0])),o=Math.max(u[0],Math.min(u[1],n[1])),n[0]===l&&n[1]===o},m=function(e){var r;r=n.mouse(e),o?(u.push(r),o=!1):(b(r)&&u.splice(u.length-1,1,r),a(),t.call("brush",this))},d=function(){return n.select(window).on("dblclick.brush",null).on("mousemove.brush",null),l=!0,2===u.length&&u[0][0]===u[1][0]&&u[0][1]===u[1][1]&&u.splice(0,u.length),n.select(".extent").on("mousedown.brush",w),t.call("brushend",this)},g=function(){var e,r=this;if(n.select(this),e=n.select(window),o=!0,!s)return l&&(u.splice(0,u.length),l=!1,n.select(".extent").on("mousedown.brush",null),e.on("mousemove.brush",function(){return m(r)}).on("dblclick.brush",d),t.call("brushstart",this)),u.length>1&&u.pop(),u.push(n.mouse(this)),a();s=!1},p=function(e){var r,l,o,s,c,h,f,m,d,g;for(o=n.mouse(e),s=o[0]-i[0],c=o[1]-i[1],l=!1,i=o,h=function(n){n[0]+=s,n[1]+=c},f=0,d=u.length;f<d;f++)h(u[f]);for(r=function(n){return b(n)||(l=!0),l},m=0,g=u.length;m<g;m++)r(u[m]);if(!l)return a(),t.call("brush",this,{mode:"move"})},v=function(){return n.select(window).on("mousemove.brush",null).on("mouseup.brush",null),s=!0,t.call("brushend",this)},w=function(){var t=this;n.event.stopPropagation(),n.event.preventDefault(),l&&!h.empty()&&(n.select(window).on("mousemove.brush",function(){return p(t)}).on("mouseup.brush",v),i=n.mouse(this))};return h.isWithinExtent=function(n,t){var e,r,l,o,s,i,c;for(r=u.length-1,s=!1,e=i=0,c=u.length;i<c;e=++i)l=u[e],o=u[r],l[1]>t!=o[1]>t&&n<(o[0]-l[0])*(t-l[1])/(o[1]-l[1])+l[0]&&(s=!s),r=e;return s},h.x=function(n){return arguments.length?(e=n,h):e},h.y=function(n){return arguments.length?(r=n,h):r},h.extent=function(n){return arguments.length?(u=n,h):u},h.clear=function(){return u.splice(0,u.length),h},h.empty=function(){return 0===u.length},h.on=function(n,e){return t.on(n,e),h},h}}(d3);