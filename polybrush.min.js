!function(n){n.polybrush=function(){var t=n.dispatch("brushstart","brush","brushend"),e=null,r=null,u=null,l=[],s=!0,o=!0,i=!1,c=null,h=n.line().x(function(n){return n[0]}).y(function(n){return n[1]}),a=function(t){e=t,t.each(function(){var e,s;e=(t=n.select(this).style("pointer-events","all").on("click.brush",p)).selectAll(".background").data([0]).enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([l]).enter().append("path").attr("class","extent").style("cursor","move"),r&&(s=b(r.range()),e.attr("x",s[0]).attr("width",s[1]-s[0])),u&&(s=b(u.range()),e.attr("y",s[0]).attr("height",s[1]-s[0]))})},f=function(){return e.each(function(){n.select(this).selectAll("g path").attr("d",function(n){return h(n)+"Z"})})},b=function(n){var t,e;return t=n[0],e=n[n.length-1],t<e?[t,e]:[e,t]},m=function(n){var t,e,l,s;return t=b(r.range()),e=b(u.range()),l=Math.max(t[0],Math.min(t[1],n[0])),s=Math.max(e[0],Math.min(e[1],n[1])),n[0]===l&&n[1]===s},d=function(e){var r;r=n.mouse(e),o?(l.push(r),o=!1):(m(r)&&l.splice(l.length-1,1,r),f(),t.call("brush",this))},g=function(){return n.select(window).on("dblclick.brush",null).on("mousemove.brush",null),s=!0,2===l.length&&l[0][0]===l[1][0]&&l[0][1]===l[1][1]&&l.splice(0,l.length),n.select(".extent").on("mousedown.brush",x),t.call("brushend",this)},p=function(){var e,r=this;if(n.select(this),e=n.select(window),o=!0,!i)return s&&(l.splice(0,l.length),s=!1,n.select(".extent").on("mousedown.brush",null),e.on("mousemove.brush",function(){return d(r)}).on("dblclick.brush",g),t.call("brushstart",this)),l.length>1&&l.pop(),l.push(n.mouse(this)),f();i=!1},v=function(e){var r,u,s,o,i,h,a,b,d,g;for(s=n.mouse(e),o=s[0]-c[0],i=s[1]-c[1],u=!1,c=s,h=function(n){n[0]+=o,n[1]+=i},a=0,d=l.length;a<d;a++)h(l[a]);for(r=function(n){return m(n)||(u=!0),u},b=0,g=l.length;b<g;b++)r(l[b]);if(!u)return f(),t.call("brush",this,{mode:"move"})},w=function(){return n.select(window).on("mousemove.brush",null).on("mouseup.brush",null),i=!0,t.call("brushend",this)},x=function(){var t=this;n.event.stopPropagation(),n.event.preventDefault(),s&&!a.empty()&&(n.select(window).on("mousemove.brush",function(){return v(t)}).on("mouseup.brush",w),c=n.mouse(this))};return a.isWithinExtent=function(n,t){var e,r,u,s,o,i,c;for(r=l.length-1,o=!1,e=i=0,c=l.length;i<c;e=++i)u=l[e],s=l[r],u[1]>t!=s[1]>t&&n<(s[0]-u[0])*(t-u[1])/(s[1]-u[1])+u[0]&&(o=!o),r=e;return o},a.x=function(n){return arguments.length?(r=n,a):r},a.y=function(n){return arguments.length?(u=n,a):u},a.extent=function(n){return arguments.length?(l=n,a):l},a.clear=function(){return l.splice(0,l.length),a},a.empty=function(){return 0===l.length},a.on=function(n,e){return t.on(n,e),a},a}}(d3);